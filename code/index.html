<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Estudiantes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // YOUR DARK MODE SCRIPT (applyDarkMode, updateDarkModeButton, toggleDarkMode, initTheme)
        // REMAINS THE SAME AS IN YOUR PREVIOUS FULL CODE.
        function applyDarkMode(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.documentElement.setAttribute('data-bs-theme', 'dark');
                localStorage.theme = 'dark';
            } else {
                document.documentElement.classList.remove('dark');
                document.documentElement.setAttribute('data-bs-theme', 'light');
                localStorage.theme = 'light';
            }
        }

        function updateDarkModeButton(isDark) {
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i> Modo Claro' : '<i class="fas fa-moon"></i> Modo Oscuro';
                darkModeToggle.setAttribute('aria-label', isDark ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro');
            }
        }
        
        function toggleDarkMode() {
            const currentTheme = localStorage.theme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const isDark = currentTheme !== 'dark';
            applyDarkMode(isDark);
            updateDarkModeButton(isDark);
        }

        function initTheme() {
            const isDark = localStorage.theme === 'dark' ||
                (!('theme' in localStorage) &&
                    window.matchMedia('(prefers-color-scheme: dark)').matches);

            applyDarkMode(isDark);
            updateDarkModeButton(isDark);

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!('theme'in localStorage)) {
                    const isSystemDark = e.matches;
                    applyDarkMode(isSystemDark);
                    updateDarkModeButton(isSystemDark);
                }
            });
        }
        document.addEventListener('DOMContentLoaded', initTheme);
    </script>
    <style>
        /* --- NEW COLOR PALETTE INTEGRATION --- */
        :root {
            --bs-font-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --bs-body-font-size: 0.9rem;

            /* Light Theme Custom Palette */
            --bs-primary: #2563d0;         /* Strong Blue */
            --bs-primary-rgb: 37, 99, 208;
            --bs-secondary: #75626b;       /* Muted Mauve */
            --bs-secondary-rgb: 117, 98, 107;
            --bs-success: #327486;         /* Teal */
            --bs-success-rgb: 50, 116, 134;
            --bs-info: #26c3ef;            /* Bright Cyan */
            --bs-info-rgb: 38, 195, 239;
            --bs-warning: #e7a3b4;         /* Soft Pink (as Warning) */
            --bs-warning-rgb: 231, 163, 180;
            --bs-danger: #e7a3b4;          /* Soft Pink (as Danger - consider a real red if possible) */
            --bs-danger-rgb: 231, 163, 180;
            
            --bs-light: #f7f8fc; /* A very light neutral for light backgrounds */
            --bs-light-rgb: 247, 248, 252;
            --bs-dark: #494b54;            /* Dark Gray (from palette, for text or dark elements) */
            --bs-dark-rgb: 73, 75, 84;

            --bs-body-color: #1b3c83;      /* Dark Blue (from palette) for text */
            --bs-body-color-rgb: 27, 60, 131;
            --bs-body-bg: #ffffff;         /* Pure white for main background */
            --bs-body-bg-rgb: 255, 255, 255;

            --bs-emphasis-color: #1b3c83; /* Darker text */
            --bs-emphasis-color-rgb: 27, 60, 131;
            --bs-secondary-color: rgba(var(--bs-body-color-rgb), 0.75);
            --bs-tertiary-color: rgba(var(--bs-body-color-rgb), 0.5);
            --bs-secondary-bg: #f0f2f5; /* Lighter background for elements like cards if needed */
            --bs-tertiary-bg: #e9ecef;

            --bs-border-color: #d1d8e0; /* Lighter border */
            --bs-border-color-translucent: rgba(var(--bs-dark-rgb), 0.175); /* Using dark from palette */
        }

        html[data-bs-theme="dark"] {
            --bs-primary: #26c3ef;         /* Bright Cyan (as primary in dark mode for pop) */
            --bs-primary-rgb: 38, 195, 239;
            --bs-secondary: #75626b;       /* Muted Mauve */
            --bs-secondary-rgb: 117, 98, 107;
            --bs-success: #327486;         /* Teal (might need slight lightening for dark bg) */
            --bs-success-rgb: 50, 116, 134;
            --bs-info: #2563d0;            /* Strong Blue (as info in dark mode) */
            --bs-info-rgb: 37, 99, 208;
            --bs-warning: #e7a3b4;         /* Soft Pink */
            --bs-warning-rgb: 231, 163, 180;
            --bs-danger: #e7a3b4;          /* Soft Pink */
            --bs-danger-rgb: 231, 163, 180;

            --bs-light: #494b54;           /* Dark Gray (from palette, as "light" elements on dark bg) */
            --bs-light-rgb: 73, 75, 84;
            --bs-dark: #e0e7ff;            /* Very light (almost white blueish) for "dark" text on dark bg */
            --bs-dark-rgb: 224, 231, 255;

            --bs-body-color: #c9d1d9;      /* Light gray for text */
            --bs-body-color-rgb: 201, 209, 217;
            --bs-body-bg: #23262a;         /* Very Dark Gray (from palette) for main background */
            --bs-body-bg-rgb: 35, 38, 42;
            
            --bs-emphasis-color: #f0f6fc; /* Whiter text */
            --bs-emphasis-color-rgb: 240,246,252;
            --bs-secondary-color: rgba(var(--bs-body-color-rgb), 0.75);
            --bs-tertiary-color: rgba(var(--bs-body-color-rgb), 0.5);
            --bs-secondary-bg: #2a2e34;  /* Slightly lighter than main dark bg */
            --bs-tertiary-bg: #30343a;

            --bs-border-color: #515559;    /* Medium-Dark Gray (from palette) for borders */
            --bs-border-color-translucent: rgba(var(--bs-light-rgb), 0.1); /* Using light from palette */

            /* Custom text colors for specific backgrounds if needed */
            --bs-warning-text-emphasis: #1b3c83; /* Dark Blue text on Pink Warning */
            --bs-danger-text-emphasis: #1b3c83;  /* Dark Blue text on Pink Danger */
        }
        /* --- END OF NEW COLOR PALETTE INTEGRATION --- */

        body {
            font-family: var(--bs-font-sans-serif);
            font-size: var(--bs-body-font-size);
        }

        .sidebar {
            position: fixed; top: 0; bottom: 0; left: 0; z-index: 100;
            padding: 56px 0 0; 
            box-shadow: inset -1px 0 0 var(--bs-border-color-translucent);
            transition: all 0.3s ease-in-out;
            width: 250px;
            background-color: var(--bs-tertiary-bg); /* Use a slightly off-main background */
        }
        
        .sidebar-sticky {
            position: relative; top: 0; height: calc(100vh - 56px); 
            padding-top: .5rem; overflow-x: hidden; overflow-y: auto; 
        }

        .sidebar .nav-link {
            font-weight: 500;
            color: var(--bs-secondary-color); /* Slightly muted link color */
            padding: .65rem 1.25rem; 
            border-left: 3px solid transparent; 
            transition: background-color 0.2s ease, color 0.2s ease, border-left-color 0.2s ease;
        }

        .sidebar .nav-link .fas {
            margin-right: 10px; width: 20px; text-align: center;
            color: var(--bs-tertiary-color); /* Muted icon color */
            transition: color 0.2s ease;
        }
        
        .sidebar .nav-link:hover .fas,
        .sidebar .nav-link.active .fas {
            color: var(--bs-primary); /* Icon color matches active/hover link text */
        }

        .sidebar .nav-link:hover {
            color: var(--bs-primary); 
            background-color: rgba(var(--bs-primary-rgb), 0.05); 
        }

        .sidebar .nav-link.active {
            color: var(--bs-primary); 
            font-weight: 600; 
            background-color: rgba(var(--bs-primary-rgb), 0.1); 
            border-left-color: var(--bs-primary); 
        }

        .navbar.fixed-top { z-index: 1030; height: 56px; background-color: var(--bs-body-bg); }
        .navbar-brand { font-weight: 600; color: var(--bs-emphasis-color); }
        .navbar .form-select, .navbar .btn {
            border-color: var(--bs-border-color);
        }


        .main-content {
            margin-left: 250px; padding: 20px;
            padding-top: calc(56px + 20px); 
            transition: margin-left 0.3s ease-in-out;
            min-height: calc(100vh - 56px); 
            background-color: var(--bs-body-bg);
        }

        @media (max-width: 767.98px) {
            .sidebar { left: -250px; padding-top: 0; z-index: 1020; background-color: var(--bs-secondary-bg); } /* Darker when overlaid */
            .sidebar.active { left: 0; box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15); }
            .main-content { margin-left: 0; }
        }
        .sidebar-toggler { display: none; }
        @media (max-width: 767.98px) { .sidebar-toggler { display: inline-block; } }
        
        .loading { text-align: center; padding: 2rem; display: none; }
        .section-content { display: none; }
        .section-content.active { display: block; }

        .semaforo-calificacion { display: inline-flex; align-items: center; gap: 0.5rem; }
        .punto-semaforo { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 4px; }
        .semaforo-rojo { background-color: var(--bs-danger); }  /* Using palette color */
        .semaforo-amarillo { background-color: #ffc107; } /* Standard yellow, palette pink is for warning */
        .semaforo-verde { background-color: var(--bs-success); } /* Using palette color */
        .texto-semaforo { font-weight: 500; font-size: 0.85rem; color: var(--bs-body-color); }

        .bg-soft-primary { background-color: rgba(var(--bs-primary-rgb), 0.1) !important; }
        .bg-soft-success { background-color: rgba(var(--bs-success-rgb), 0.1) !important; }
        .bg-soft-danger { background-color: rgba(var(--bs-danger-rgb), 0.1) !important; }
        .bg-soft-info { background-color: rgba(var(--bs-info-rgb), 0.1) !important; }
        .bg-soft-warning { background-color: rgba(var(--bs-warning-rgb), 0.1) !important; }
        
        /* Ensure text on soft backgrounds is readable */
        .text-primary { color: var(--bs-primary) !important; }
        .text-success { color: var(--bs-success) !important; }
        .text-danger { color: var(--bs-danger) !important; }
        html[data-bs-theme="dark"] .text-danger { color: var(--bs-danger-text-emphasis) !important;} /* For pink danger bg */
        .text-info { color: var(--bs-info) !important; }
        .text-warning { color: var(--bs-warning) !important; }
         html[data-bs-theme="dark"] .text-warning { color: var(--bs-warning-text-emphasis) !important;} /* For pink warning bg */


        .card { 
            border: 1px solid var(--bs-border-color); 
            box-shadow: 0 0.125rem 0.25rem rgba(var(--bs-dark-rgb),.075); 
            background-color: var(--bs-secondary-bg); /* Slightly off-main bg for cards */
        }
        html[data-bs-theme="dark"] .card {
             background-color: var(--bs-tertiary-bg); /* Darker cards */
        }

        .card-header { 
            background-color: transparent; 
            border-bottom: 1px solid var(--bs-border-color); 
            color: var(--bs-emphasis-color);
        }
        .card h6.text-muted { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--bs-secondary-color) !important; }
        .card h3, .card h4 { font-weight: 600; color: var(--bs-emphasis-color); }
        .card .icon-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;}

        .chart-container { position: relative; }
        
        html[data-bs-theme="dark"] .dataTables_wrapper .dataTables_length label,
        html[data-bs-theme="dark"] .dataTables_wrapper .dataTables_filter label,
        html[data-bs-theme="dark"] .dataTables_wrapper .dataTables_info,
        html[data-bs-theme="dark"] .dataTables_paginate .page-link {
            color: var(--bs-secondary-color);
        }
        html[data-bs-theme="dark"] .dataTables_paginate .page-link.disabled {
            color: var(--bs-tertiary-color);
        }
        html[data-bs-theme="dark"] .table {
            --bs-table-color: var(--bs-body-color);
            --bs-table-bg: transparent; /* Let card bg show */
            --bs-table-border-color: var(--bs-border-color);
            --bs-table-striped-bg: rgba(var(--bs-light-rgb), 0.05); /* Subtle striping */
            --bs-table-hover-bg: rgba(var(--bs-light-rgb), 0.075);
        }
        html[data-bs-theme="dark"] .page-item.active .page-link {
             background-color: var(--bs-primary);
             border-color: var(--bs-primary);
             color: var(--bs-dark) !important; /* Ensure text is dark on primary bg */
        }
        .table-hover tbody tr:hover {
            color: var(--bs-emphasis-color);
            background-color: var(--bs-table-hover-bg);
        }
        .table > :not(caption) > * > * { /* Remove default table bg for cards */
             background-color: transparent !important;
        }
        thead.table-light th { /* For group/equipo templates */
            background-color: var(--bs-tertiary-bg) !important;
            color: var(--bs-emphasis-color) !important;
        }
        html[data-bs-theme="dark"] thead.table-light th {
             background-color: rgba(var(--bs-light-rgb), 0.1) !important;
        }

        /* Badge colors from palette */
        .badge.bg-success { background-color: var(--bs-success) !important; color: white !important; }
        .badge.bg-danger { background-color: var(--bs-danger) !important; color: var(--bs-danger-text-emphasis) !important; } /* Using custom text for pink */
        .badge.bg-primary { background-color: var(--bs-primary) !important; }
        .badge.bg-info { background-color: var(--bs-info) !important; }
        .badge.bg-warning { background-color: var(--bs-warning) !important; color: var(--bs-warning-text-emphasis) !important; }

    </style>
</head>

<body>
    <!-- Navbar (remains the same structure) -->
    <nav class="navbar navbar-expand-md fixed-top border-bottom">
        <div class="container-fluid">
            <button class="btn btn-outline-secondary me-2 sidebar-toggler" type="button" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <a class="navbar-brand" href="#">Dashboard Estudiantes</a>
            
            <div class="ms-auto d-flex align-items-center">
                <div class="dropdown me-2">
                    <select id="grupoFilter" class="form-select form-select-sm" aria-label="Filtrar por grupo">
                        <option value="">Todos los grupos</option>
                    </select>
                </div>
                <div class="dropdown me-2">
                    <select id="equipoFilter" class="form-select form-select-sm" aria-label="Filtrar por equipo">
                        <option value="">Todos los equipos</option>
                    </select>
                </div>
                <div class="dropdown me-2">
                    <select id="estadoFilter" class="form-select form-select-sm" aria-label="Filtrar por estado">
                        <option value="">Todos</option>
                        <option value="Aprobado">Aprobado</option>
                        <option value="Reprobado">Reprobado</option>
                    </select>
                </div>
                <button id="resetFilters" class="btn btn-sm btn-outline-secondary me-3" title="Limpiar filtros">
                    <i class="fas fa-undo-alt"></i>
                </button>
                <button id="darkModeToggle" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-moon"></i> Modo Oscuro
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar (remains the same structure) -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="sidebar-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"> <a class="nav-link active" href="#" data-section="visionGeneral"> <i class="fas fa-tachometer-alt"></i> Visión General </a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#" data-section="listaEstudiantes"> <i class="fas fa-users"></i> Lista de Estudiantes </a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#" data-section="topEstudiantes"> <i class="fas fa-trophy"></i> Top Estudiantes </a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#" data-section="alumnosReprobados"> <i class="fas fa-user-times"></i> Alumnos Reprobados </a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#" data-section="analisisGruposEquipos"> <i class="fas fa-sitemap"></i> Grupos y Equipos </a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#" data-section="rendimientoActividades"> <i class="fas fa-tasks"></i> Rendimiento Actividades </a> </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content (structure remains the same, content needs careful placement) -->
            <main class="main-content col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="loading spinner-border text-primary" role="status"> <span class="visually-hidden">Cargando...</span> </div>

                <!-- SECCIÓN: Visión General -->
                <div id="visionGeneral" class="section-content active">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Visión General</h2>
                    <!-- ... (Your cards and charts for this section, as in previous full code) ... -->
                    <!-- Example card: -->
                    <div class="row mb-4">
                        <div class="col-6 col-sm-4 col-lg-2 mb-3"> <div class="card text-center h-100"> <div class="card-body"> <div class="icon-circle bg-soft-primary text-primary mx-auto mb-2"><i class="fas fa-users fa-lg"></i></div> <h6 class="text-muted mb-1">Total</h6> <h3 class="mb-0" id="totalEstudiantes">0</h3> </div> </div> </div>
                        <div class="col-6 col-sm-4 col-lg-2 mb-3"> <div class="card text-center h-100"> <div class="card-body"> <div class="icon-circle bg-soft-success text-success mx-auto mb-2"><i class="fas fa-check-circle fa-lg"></i></div> <h6 class="text-muted mb-1">Aprobados</h6> <h3 class="mb-0 text-success" id="totalAprobados">0</h3> <small class="text-muted" id="porcentajeAprobados">0%</small> </div> </div> </div>
                        <div class="col-6 col-sm-4 col-lg-2 mb-3"> <div class="card text-center h-100"> <div class="card-body"> <div class="icon-circle bg-soft-danger text-danger mx-auto mb-2"><i class="fas fa-times-circle fa-lg"></i></div> <h6 class="text-muted mb-1">Reprobados</h6> <h3 class="mb-0 text-danger" id="totalReprobados">0</h3> <small class="text-muted" id="porcentajeReprobados">0%</small> </div> </div> </div>
                        <div class="col-6 col-sm-4 col-lg-2 mb-3"> <div class="card text-center h-100"> <div class="card-body"> <div class="icon-circle bg-soft-info text-info mx-auto mb-2"><i class="fas fa-percentage fa-lg"></i></div> <h6 class="text-muted mb-1">% Aprobación</h6> <h3 class="mb-0 text-info" id="porcentajeAprobacion">0%</h3> </div> </div> </div>
                        <div class="col-12 col-sm-4 col-lg-2 mb-3"> <div class="card text-center h-100"> <div class="card-body"> <div class="icon-circle bg-soft-warning text-warning mx-auto mb-2"><i class="fas fa-chart-line fa-lg"></i></div> <h6 class="text-muted mb-1">Promedio Gral.</h6> <h3 class="mb-0 text-warning" id="promedioGeneral">0.0</h3> <small class="text-muted">de 10.0</small> </div> </div> </div>
                    </div>
                     <h4 class="h5 mb-3">Desempeños Destacados</h4>
                     <div class="row mb-4">
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-success text-success me-3"><i class="fas fa-medal fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Mejor Estudiante</h6> <h4 class="mb-0 text-success" id="mejorEstudiante">-</h4> <small class="text-muted">Cal: <span id="puntajeMejorEstudiante">0.0</span></small> </div> </div> </div> </div>
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-primary text-primary me-3"><i class="fas fa-users fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Mejor Equipo</h6> <h4 class="mb-0 text-primary" id="mejorEquipo">-</h4> <small class="text-muted">Prom: <span id="promedioMejorEquipo">0.0</span></small> </div> </div> </div> </div>
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-info text-info me-3"><i class="fas fa-trophy fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Mejor Grupo</h6> <h4 class="mb-0 text-info" id="mejorGrupo">-</h4> <small class="text-muted">Prom: <span id="promedioMejorGrupo">0.0</span></small> </div> </div> </div> </div>
                     </div>
                     <h4 class="h5 mb-3">Áreas de Atención</h4>
                     <div class="row mb-4">
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-danger text-danger me-3"><i class="fas fa-exclamation-triangle fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Peor Estudiante</h6> <h4 class="mb-0 text-danger" id="peorEstudiante">-</h4> <small class="text-muted">Cal: <span id="puntajePeorEstudiante">0.0</span></small> </div> </div> </div> </div>
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-warning text-warning me-3"><i class="fas fa-users-slash fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Peor Equipo</h6> <h4 class="mb-0 text-warning" id="peorEquipo">-</h4> <small class="text-muted">Prom: <span id="promedioPeorEquipo">0.0</span></small> </div> </div> </div> </div>
                        <div class="col-md-4 mb-3"> <div class="card h-100"> <div class="card-body d-flex align-items-center"> <div class="icon-circle bg-soft-danger text-danger me-3"><i class="fas fa-exclamation-circle fa-lg"></i></div> <div> <h6 class="text-muted mb-1">Peor Grupo</h6> <h4 class="mb-0 text-danger" id="peorGrupo">-</h4> <small class="text-muted">Prom: <span id="promedioPeorGrupo">0.0</span></small> </div> </div> </div> </div>
                     </div>
                    <div class="row g-3 mb-4">
                        <div class="col-12 col-lg-4"> <div class="card h-100"> <div class="card-header"> <h6 class="mb-0">Distribución de Calificaciones</h6> </div> <div class="card-body p-3 chart-container" style="height: 280px;"><canvas id="calificacionesChart"></canvas> </div> </div> </div>
                        <div class="col-12 col-lg-4"> <div class="card h-100"> <div class="card-header"> <h6 class="mb-0">Promedios por Equipo</h6> </div> <div class="card-body p-3 chart-container" style="height: 280px;"><canvas id="equiposChart"></canvas> </div> </div> </div>
                        <div class="col-12 col-lg-4"> <div class="card h-100"> <div class="card-header"> <h6 class="mb-0">Estado de Aprobación</h6> </div> <div class="card-body p-3 chart-container" style="height: 280px;"><canvas id="aprobacionChart"></canvas> </div> </div> </div>
                    </div>
                </div>
                <div id="listaEstudiantes" class="section-content">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Lista de Estudiantes</h2>
                    <div class="card"> <div class="card-body"> <div class="table-responsive"> <table class="table table-hover align-middle w-100" id="estudiantesTable"> <thead> <tr> <th>ID</th> <th>Nombre</th> <th>Nick</th> <th>Grupo</th> <th>Equipo</th> <th>Asistencia</th> <th>Calificación</th> <th>Estado</th> </tr> </thead> <tbody id="estudiantesTableBody"></tbody> </table> </div> </div> </div>
                </div>
                <div id="topEstudiantes" class="section-content">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Top Estudiantes</h2>
                     <div class="card"> <div class="card-body"> <div class="table-responsive"> <table class="table table-hover align-middle w-100" id="topEstudiantesTable"> <thead> <tr> <th>#</th> <th>Estudiante</th> <th>Grupo</th> <th>Equipo</th> <th>Calificación</th> </tr> </thead> <tbody id="topEstudiantesBody"></tbody> </table> </div> </div> </div>
                </div>
                <div id="alumnosReprobados" class="section-content">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Alumnos Reprobados</h2>
                    <div class="card"> <div class="card-body"> <button class="btn btn-sm btn-danger mb-3" id="descargarReprobadosBtn"> <i class="fas fa-download me-1"></i> Descargar Tabla </button> <div class="table-responsive"> <table class="table table-hover align-middle w-100" id="reprobadosTable"> <thead> <tr> <th>Nombre</th> <th>Grupo</th> <th>Cal. Final</th> </tr> </thead> <tbody id="reprobadosTableBody"></tbody> </table> </div> </div> </div>
                </div>
                <div id="analisisGruposEquipos" class="section-content">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Análisis de Grupos y Equipos</h2>
                    <div id="gruposContainer"></div>
                </div>
                <div id="rendimientoActividades" class="section-content">
                    <h2 class="h3 mb-4 pt-3 border-bottom pb-2">Rendimiento de Actividades</h2>
                    <!-- Your detailed activity cards and charts here, like in the previous full code example -->
                    <!-- Make sure canvas containers have explicit heights, e.g., style="height: 250px;" -->
                    <div class="mb-4"> <!-- Removed bg-body-tertiary to let card bg handle it -->
                        <h5 class="mb-3 fw-semibold">Actividades</h5>
                        <div class="row mb-4">
                            <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <div class="d-flex align-items-center mb-2"> <div class="icon-circle bg-soft-success text-success me-2"><i class="fas fa-check-circle"></i></div> <h6 class="card-title mb-0 text-muted">Más Entregada</h6> </div> <h5 id="actividadMasEntregada" class="mb-1">-</h5> <small id="porcentajeMasEntregada" class="text-muted">0%</small> </div> </div> </div>
                            <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <div class="d-flex align-items-center mb-2"> <div class="icon-circle bg-soft-danger text-danger me-2"><i class="fas fa-times-circle"></i></div> <h6 class="card-title mb-0 text-muted">Menos Entregada</h6> </div> <h5 id="actividadMenosEntregada" class="mb-1">-</h5> <small id="porcentajeMenosEntregada" class="text-muted">0%</small> </div> </div> </div>
                            <div class="col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header py-2"> <h6 class="mb-0">Comparativa Actividades</h6> </div> <div class="card-body p-2 chart-container" style="height: 200px;"><canvas id="actividadesChart2"></canvas></div> </div> </div>
                            <div class="col-12"> <div class="card"> <div class="card-header py-2"> <h6 class="mb-0">Entregas por Actividad</h6> </div> <div class="card-body p-2 chart-container" style="height: 250px;"><canvas id="entregasActividadesChart"></canvas></div> </div> </div>
                        </div>
                    </div>
                     <div class="mb-4">
                        <h5 class="mb-3 fw-semibold">Cuestionarios</h5>
                        <div class="row mb-4">
                           <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <div class="d-flex align-items-center mb-2"> <div class="icon-circle bg-soft-success text-success me-2"><i class="fas fa-clipboard-check"></i></div> <h6 class="card-title mb-0 text-muted">Más Entregado</h6> </div> <h5 id="cuestionarioMasEntregado" class="mb-1">-</h5> <small id="porcentajeCuestionarioMas" class="text-muted">0%</small> </div> </div> </div>
                           <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <div class="d-flex align-items-center mb-2"> <div class="icon-circle bg-soft-danger text-danger me-2"><i class="fas fa-clipboard-list"></i></div> <h6 class="card-title mb-0 text-muted">Menos Entregado</h6> </div> <h5 id="cuestionarioMenosEntregado" class="mb-1">-</h5> <small id="porcentajeCuestionarioMenos" class="text-muted">0%</small> </div> </div> </div>
                           <div class="col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header py-2"> <h6 class="mb-0">Comparativa Cuestionarios</h6> </div> <div class="card-body p-2 chart-container" style="height: 200px;"><canvas id="cuestionariosRadarChart"></canvas></div> </div> </div>
                           <div class="col-12"> <div class="card"> <div class="card-header py-2"> <h6 class="mb-0">Entregas por Cuestionario</h6> </div> <div class="card-body p-2 chart-container" style="height: 250px;"><canvas id="entregasCuestionariosChart"></canvas></div> </div> </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h5 class="mb-3 fw-semibold">Proyectos, Bitácoras y Puntos Extra</h5>
                        <div class="row mb-4">
                            <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <h6 class="card-title text-muted d-flex align-items-center"><i class="fas fa-project-diagram me-2 text-primary"></i> Proyecto</h6> <div class="mt-2"> <div class="d-flex justify-content-between small"><span class="text-muted">Entregados:</span><span id="proyectoEntregados" class="fw-semibold">0</span></div> <div class="d-flex justify-content-between small"><span class="text-muted">Pendientes:</span><span id="proyectoPendientes" class="fw-semibold">0</span></div> <div class="d-flex justify-content-between small"><span class="text-muted">Promedio:</span><span id="proyectoPromedio" class="fw-semibold">0.0</span></div> </div> <div class="text-center mt-2 chart-container" style="height: 120px;"><canvas id="proyectoEntregaChart"></canvas></div> <h5 class="text-center mt-1 mb-0" id="porcentajeEntregaProyecto">0%</h5></div> </div> </div>
                            <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <h6 class="card-title text-muted d-flex align-items-center"><i class="fas fa-book me-2 text-info"></i> Bitácora</h6> <div class="mt-2"> <div class="d-flex justify-content-between small"><span class="text-muted">Entregadas:</span><span id="bitacoraEntregados" class="fw-semibold">0</span></div> <div class="d-flex justify-content-between small"><span class="text-muted">Pendientes:</span><span id="bitacoraPendientes" class="fw-semibold">0</span></div> <div class="d-flex justify-content-between small"><span class="text-muted">Promedio:</span><span id="bitacoraPromedio" class="fw-semibold">0.0</span></div> </div> <div class="text-center mt-2 chart-container" style="height: 120px;"><canvas id="bitacoraEntregaChart"></canvas></div> <h5 class="text-center mt-1 mb-0" id="porcentajeEntregaBitacora">0%</h5></div> </div> </div>
                            <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-body"> <h6 class="card-title text-muted d-flex align-items-center"><i class="fas fa-star me-2 text-warning"></i> Puntos Extra</h6> <div class="mt-2"> <div class="d-flex justify-content-between small"><span class="text-muted">Obtenidos por:</span><span id="puntosExtraEntregados" class="fw-semibold">-</span></div> <div class="d-flex justify-content-between small"><span class="text-muted">Porcentaje:</span><span id="puntosExtraPorcentaje" class="fw-semibold">-</span></div></div> <div class="mt-2 chart-container" style="height: 150px;"><canvas id="puntosExtraChart"></canvas></div></div></div></div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 mb-3"> <div class="card"> <div class="card-header py-2"><h6 class="mb-0">Calificaciones Proyecto</h6></div> <div class="card-body p-2 chart-container" style="height: 230px;"><canvas id="proyectoCalificacionesChart"></canvas></div> </div> </div>
                            <div class="col-lg-6 mb-3"> <div class="card"> <div class="card-header py-2"><h6 class="mb-0">Calificaciones Bitácora</h6></div> <div class="card-body p-2 chart-container" style="height: 230px;"><canvas id="bitacoraCalificacionesChart"></canvas></div> </div> </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Templates (remain the same) -->
    <template id="grupoTemplate">
        <div class="grupo-section mb-5 border-top pt-4">
            <h3 class="mb-4 text-primary">Grupo <span class="grupo-nombre"></span></h3>
            <div class="row">
                <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100 border-primary"> <div class="card-header bg-primary text-white"> <h5 class="mb-0">Mejor Estudiante</h5> </div> <div class="card-body text-center"> <h4 class="mejor-estudiante">-</h4> <p class="mb-0">Calificación: <span class="mejor-calificacion">-</span></p> </div> </div> </div>
                <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100 border-success"> <div class="card-header bg-success text-white"> <h5>Estadísticas</h5> </div> <div class="card-body"> <p class="mb-1">Aprobados: <span class="aprobados">0</span></p> <p class="mb-1">Reprobados: <span class="reprobados">0</span></p> <p class="mb-0">Promedio: <span class="promedio">0.0</span></p> </div> </div> </div>
                <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header"> <h5>Distribución</h5> </div> <div class="card-body p-2 chart-container" style="height: 150px;"> <canvas class="grupo-chart"></canvas> </div> </div> </div>
            </div>
            <div class="mt-4"> <h5>Top 3 del Grupo</h5> <div class="table-responsive"> <table class="table table-sm table-hover"> <thead class="table-light"> <tr> <th>#</th><th>Estudiante</th><th>Equipo</th><th>Calificación</th> </tr> </thead> <tbody class="top3-body"></tbody> </table> </div> </div>
            <div class="equipos-container mt-4"></div>
        </div>
    </template>
    <template id="equipoTemplate">
        <div class="equipo-section mb-4 border-start border-4 border-info ps-3"> <!-- Used border-info, matches new info color -->
            <h4 class="mb-3 text-secondary">Equipo: <span class="equipo-nombre"></span></h4>
            <div class="row">
                <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header bg-info text-white"> <h6 class="mb-0">Mejor Estudiante</h6> </div> <div class="card-body p-2 text-center"> <p class="mb-1"><span class="mejor-estudiante">-</span></p> <p class="mb-0">Calificación: <span class="mejor-calificacion">-</span></p> </div> </div> </div>
                <div class="col-md-6 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header"> <h6 class="mb-0">Estadísticas</h6> </div> <div class="card-body p-2"> <p class="mb-1">Miembros: <span class="total-miembros">0</span></p> <p class="mb-0">Promedio: <span class="promedio">0.0</span></p> </div> </div> </div>
                <div class="col-md-12 col-lg-4 mb-3"> <div class="card h-100"> <div class="card-header"> <h6 class="mb-0">Distribución</h6> </div> <div class="card-body p-2 chart-container" style="height: 130px;"> <canvas class="equipo-chart"></canvas> </div> </div> </div>
            </div>
            <div class="table-responsive"> <table class="table table-sm table-hover"> <thead class="table-light"> <tr> <th>Estudiante</th><th>Calificación</th><th>Estado</th> </tr> </thead> <tbody class="equipo-miembros"></tbody> </table> </div>
        </div>
    </template>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="app.js"></script>
</body>
</html>